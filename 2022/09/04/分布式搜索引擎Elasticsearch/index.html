<!DOCTYPE html><html class="appearance-auto" lang="zh-CN"><head><meta charset="UTF-8"><title>分布式搜索引擎Elasticsearch</title><meta name="description" content="满船清梦"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><!-- Google Analytics --><!-- End Google Analytics -->
<!-- Baidu Analytics --><!-- End Baidu Analytics --><link rel="icon" href="/images/favicon.png"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/themes/highlight-theme-light.css"><script src="/js/highlight.pack.js"></script><meta name="description" content="
分布式搜索引擎Elasticsearch1.引言
本篇内容为简单学习elasticsearch的记录

2.初识elasticsearch2.1.了解elasticsearch2.1.1.简介
Elasticsearch 是位于 Elastic Stack 核心的分布式搜索和分析引擎。Logstash 和 Beats 有助于收集、聚合和丰富您的数据并将其存储在 Elasticsearch 中。Kibana 使您能够以交互方式探索、可视化和分享对数据的见解，并管理和监控堆栈。Elasticsearch 是索引、搜索和分析魔法发生的地方。
Elasticsearch 为所有类型的数据提供近乎实时的搜索和分析。无论您拥有结构化或非结构化文本、数字数据还是地理空间数据，Elasticsearch 都能以支持快速搜.."><meta name="generator" content="Hexo 5.4.2">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">mmjzxz's blog</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">分布式搜索引擎Elasticsearch</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">点击返回顶部</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">首页</a></h3><h3 class="is-inline-block"><a href="/about">关于</a></h3><h3 class="is-inline-block"><a href="/archives">归档</a></h3></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">首页</a></h3><h3 class="is-inline-block"><a href="/about">关于</a></h3><h3 class="is-inline-block"><a href="/archives">归档</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8EElasticsearch"><span class="toc-text">分布式搜索引擎Elasticsearch</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%BC%95%E8%A8%80"><span class="toc-text">1.引言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%88%9D%E8%AF%86elasticsearch"><span class="toc-text">2.初识elasticsearch</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E4%BA%86%E8%A7%A3elasticsearch"><span class="toc-text">2.1.了解elasticsearch</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-1-%E7%AE%80%E4%BB%8B"><span class="toc-text">2.1.1.简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-2-ELK"><span class="toc-text">2.1.2.ELK</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95"><span class="toc-text">2.2.倒排索引</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1-%E6%AD%A3%E6%8E%92%E7%B4%A2%E5%BC%95"><span class="toc-text">2.2.1.正排索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-2-%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95"><span class="toc-text">2.2.2.倒排索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-3-%E6%AD%A3%E6%8E%92%E7%B4%A2%E5%BC%95%E4%B8%8E%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-text">2.2.3.正排索引与倒排索引优缺点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E5%AE%89%E8%A3%85"><span class="toc-text">2.3.安装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-1-%E9%83%A8%E7%BD%B2elasticsearch"><span class="toc-text">2.3.1.部署elasticsearch</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-1-1-%E5%88%9B%E5%BB%BA%E7%BD%91%E7%BB%9C"><span class="toc-text">2.3.1.1.创建网络</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-1-2-%E5%8A%A0%E8%BD%BD%E9%95%9C%E5%83%8F"><span class="toc-text">2.3.1.2.加载镜像</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-1-3-%E8%BF%90%E8%A1%8C"><span class="toc-text">2.3.1.3.运行</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-2-%E9%83%A8%E7%BD%B2kibana"><span class="toc-text">2.3.2.部署kibana</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-2-1-%E9%83%A8%E7%BD%B2"><span class="toc-text">2.3.2.1.部署</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-3-%E5%AE%89%E8%A3%85IK%E5%88%86%E8%AF%8D%E5%99%A8"><span class="toc-text">2.3.3.安装IK分词器</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-3-1-%E5%9C%A8%E7%BA%BF%E5%AE%89%E8%A3%85ik%E6%8F%92%E4%BB%B6"><span class="toc-text">2.3.3.1.在线安装ik插件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-3-2-%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85ik%E6%8F%92%E4%BB%B6"><span class="toc-text">2.3.3.2.离线安装ik插件</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#2-3-3-2-1-%E6%9F%A5%E7%9C%8B%E6%95%B0%E6%8D%AE%E5%8D%B7%E7%9B%AE%E5%BD%95"><span class="toc-text">2.3.3.2.1.查看数据卷目录</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2-3-3-2-2-%E8%A7%A3%E5%8E%8B%E7%BC%A9%E5%88%86%E8%AF%8D%E5%99%A8%E5%AE%89%E8%A3%85%E5%8C%85"><span class="toc-text">2.3.3.2.2.解压缩分词器安装包</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2-3-3-2-3-%E4%B8%8A%E4%BC%A0%E5%88%B0es%E5%AE%B9%E5%99%A8%E7%9A%84%E6%8F%92%E4%BB%B6%E6%95%B0%E6%8D%AE%E5%8D%B7%E4%B8%AD"><span class="toc-text">2.3.3.2.3.上传到es容器的插件数据卷中</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2-3-3-2-4-%E9%87%8D%E5%90%AF%E5%AE%B9%E5%99%A8"><span class="toc-text">2.3.3.2.4.重启容器</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2-3-3-2-5-%E6%B5%8B%E8%AF%95"><span class="toc-text">2.3.3.2.5.测试</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-3-3-%E6%89%A9%E5%B1%95%E8%AF%8D%E8%AF%8D%E5%85%B8"><span class="toc-text">2.3.3.3.扩展词词典</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-3-4-%E5%81%9C%E7%94%A8%E8%AF%8D%E8%AF%8D%E5%85%B8"><span class="toc-text">2.3.3.4.停用词词典</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-text">参考</span></a></li></ol></li></ol></div><div class="column is-9"><header class="my-4"><a href="/tags/elasticsearch"><i class="tag post-item-tag">elasticsearch</i></a></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">分布式搜索引擎Elasticsearch</h1><time class="has-text-grey" datetime="2022-09-04T05:14:06.000Z">2022-09-04</time><article class="mt-2 post-content"><p><img src="/2022/09/04/%E5%88%86%E5%B8%83%E5%BC%8F%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8EElasticsearch/elasticsearchbg.jpg"></p>
<h1 id="分布式搜索引擎Elasticsearch"><a href="#分布式搜索引擎Elasticsearch" class="headerlink" title="分布式搜索引擎Elasticsearch"></a>分布式搜索引擎Elasticsearch</h1><h2 id="1-引言"><a href="#1-引言" class="headerlink" title="1.引言"></a>1.引言</h2><blockquote>
<p>本篇内容为简单学习elasticsearch的记录</p>
</blockquote>
<h2 id="2-初识elasticsearch"><a href="#2-初识elasticsearch" class="headerlink" title="2.初识elasticsearch"></a>2.初识elasticsearch</h2><h3 id="2-1-了解elasticsearch"><a href="#2-1-了解elasticsearch" class="headerlink" title="2.1.了解elasticsearch"></a>2.1.了解elasticsearch</h3><h4 id="2-1-1-简介"><a href="#2-1-1-简介" class="headerlink" title="2.1.1.简介"></a>2.1.1.简介</h4><blockquote>
<p><strong>Elasticsearch</strong> 是位于 Elastic Stack 核心的分布式搜索和分析引擎。Logstash 和 Beats 有助于收集、聚合和丰富您的数据并将其存储在 <strong>Elasticsearch</strong> 中。Kibana 使您能够以交互方式探索、可视化和分享对数据的见解，并管理和监控堆栈。<strong>Elasticsearch</strong> 是索引、搜索和分析魔法发生的地方。</p>
<p><strong>Elasticsearch</strong> 为所有类型的数据提供近乎实时的搜索和分析。无论您拥有结构化或非结构化文本、数字数据还是地理空间数据，<strong>Elasticsearch</strong> 都能以支持快速搜索的方式高效地存储和索引它。您可以超越简单的数据检索和聚合信息来发现数据中的趋势和模式。随着您的数据和查询量的增长，<strong>Elasticsearch</strong> 的分布式特性使您的部署能够随之无缝增长。(<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/elasticsearch/3411206">elasticsearch_百度百科 (baidu.com)</a>)</p>
<p>源码:<a target="_blank" rel="noopener" href="https://github.com/elastic/elasticsearch">elastic/elasticsearch: Free and Open, Distributed, RESTful Search Engine (github.com)</a></p>
</blockquote>
<h4 id="2-1-2-ELK"><a href="#2-1-2-ELK" class="headerlink" title="2.1.2.ELK"></a>2.1.2.ELK</h4><blockquote>
<p><strong>ELK</strong>是三个开源软件的缩写，分别表示：<strong>Elasticsearch, Logstash, Kibana</strong> , 它们都是开源软件。 新增了一个FileBeat，它是一个轻量级的日志收集处理工具 (Agent)，Filebeat占用资源少，适合于在各个服务器上搜集日志后传输给Logstash。</p>
<p>而<strong>Elasticsearch</strong>是elastic stack的核心，负责存储、搜索、分析数据。</p>
</blockquote>
<img src="/2022/09/04/%E5%88%86%E5%B8%83%E5%BC%8F%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8EElasticsearch/ELK.png" style="zoom:80%;">

<h3 id="2-2-倒排索引"><a href="#2-2-倒排索引" class="headerlink" title="2.2.倒排索引"></a>2.2.倒排索引</h3><h4 id="2-2-1-正排索引"><a href="#2-2-1-正排索引" class="headerlink" title="2.2.1.正排索引"></a>2.2.1.正排索引</h4><blockquote>
<p>正排表是以文档的ID为关键字，表中记录文档中每个字的位置信息，查找时扫描表中每个文档中字的信息直到找出所有包含查询关键字的文档。</p>
</blockquote>
<p><img src="/2022/09/04/%E5%88%86%E5%B8%83%E5%BC%8F%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8EElasticsearch/forward_index_example.png"></p>
<blockquote>
<p>给下表（tb_goods）中的id创建索引：</p>
</blockquote>
<p><img src="/2022/09/04/%E5%88%86%E5%B8%83%E5%BC%8F%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8EElasticsearch/tb_goods.png"></p>
<blockquote>
<p>如果是根据id查询，那么直接走索引，查询速度非常快。<br>但如果是基于title做模糊查询，只能是逐行扫描数据，流程如下：</p>
<ol>
<li>用户搜索数据，条件是title符合<code>"%手机%"</code></li>
<li>逐行获取数据，比如id为1的数据</li>
<li>判断数据中的title是否符合用户搜索条件</li>
<li>如果符合则放入结果集，不符合则丢弃。回到步骤1</li>
</ol>
<p>逐行扫描，也就是全表扫描，随着数据量增加，其查询效率也会越来越低。</p>
</blockquote>
<h4 id="2-2-2-倒排索引"><a href="#2-2-2-倒排索引" class="headerlink" title="2.2.2.倒排索引"></a>2.2.2.倒排索引</h4><blockquote>
<p>倒排索引源于实际应用中需要根据属性的值来查找记录。这种索引表中的每一项都包括一个属性值和具有该属性值的各记录的地址。由于不是由记录来确定属性值，而是由属性值来确定记录的位置，因而称为倒排索引(inverted index)。</p>
<ul>
<li>文档（<code>Document</code>）：用来搜索的数据，其中的每一条数据就是一个文档。例如一个网页、一个商品信息</li>
<li>词条（<code>Term</code>）：对文档数据或用户搜索数据，利用某种算法分词，得到的具备含义的词语就是词条。例如：我是中国人，就可以分为：我、是、中国人、中国、国人这样的几个词条</li>
</ul>
</blockquote>
<p><img src="/2022/09/04/%E5%88%86%E5%B8%83%E5%BC%8F%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8EElasticsearch/inverted_index.png"></p>
<blockquote>
<p><strong>创建倒排索引</strong>是对正向索引的一种特殊处理，流程如下：</p>
<ul>
<li>将每一个文档的数据利用算法分词，得到一个个词条</li>
<li>创建表，每行数据包括词条、词条所在文档id、位置等信息</li>
<li>因为词条唯一性，可以给词条创建索引，例如hash表结构索引</li>
</ul>
</blockquote>
<img src="/2022/09/04/%E5%88%86%E5%B8%83%E5%BC%8F%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8EElasticsearch/inverted_index_example.png" style="zoom: 67%;">

<blockquote>
<p>倒排索引的<strong>搜索流程</strong>如下（以搜索”华为手机”为例）：</p>
<ol>
<li><p>用户输入条件<code>"华为手机"</code>进行搜索。</p>
</li>
<li><p>对用户输入内容<strong>分词</strong>，得到词条：<code>华为</code>、<code>手机</code>。</p>
</li>
<li><p>拿着词条在倒排索引中查找，可以得到包含词条的文档id：1、2、3。</p>
</li>
<li><p>拿着文档id到正向索引中查找具体文档。</p>
</li>
</ol>
</blockquote>
<img src="/2022/09/04/%E5%88%86%E5%B8%83%E5%BC%8F%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8EElasticsearch/inverted_index_process.png" style="zoom: 67%;">

<h4 id="2-2-3-正排索引与倒排索引优缺点"><a href="#2-2-3-正排索引与倒排索引优缺点" class="headerlink" title="2.2.3.正排索引与倒排索引优缺点"></a>2.2.3.正排索引与倒排索引优缺点</h4><blockquote>
<p>正排索引：</p>
<ul>
<li>优点：<ul>
<li>可以给多个字段创建索引</li>
<li>根据索引字段搜索、排序速度非常快</li>
</ul>
</li>
<li>缺点：<ul>
<li>根据非索引字段，或者索引字段中的部分词条查找时，只能全表扫描。</li>
</ul>
</li>
</ul>
</blockquote>
<blockquote>
<p><strong>倒排索引</strong>：</p>
<ul>
<li>优点：<ul>
<li>根据词条搜索、模糊搜索时，速度非常快</li>
</ul>
</li>
<li>缺点：<ul>
<li>只能给词条创建索引，而不是字段</li>
<li>无法根据字段做排序</li>
</ul>
</li>
</ul>
</blockquote>
<h3 id="2-3-安装"><a href="#2-3-安装" class="headerlink" title="2.3.安装"></a>2.3.安装</h3><h4 id="2-3-1-部署elasticsearch"><a href="#2-3-1-部署elasticsearch" class="headerlink" title="2.3.1.部署elasticsearch"></a>2.3.1.部署elasticsearch</h4><h5 id="2-3-1-1-创建网络"><a href="#2-3-1-1-创建网络" class="headerlink" title="2.3.1.1.创建网络"></a>2.3.1.1.创建网络</h5><blockquote>
<p>由于需要部署kibana容器，因此需要让es和kibana容器互联。这里先创建一个网络：</p>
<pre><code class="sh">docker network create es-net
</code></pre>
</blockquote>
<h5 id="2-3-1-2-加载镜像"><a href="#2-3-1-2-加载镜像" class="headerlink" title="2.3.1.2.加载镜像"></a>2.3.1.2.加载镜像</h5><blockquote>
<p>将镜像tar包上传到虚拟机中，运行如下命令加载：</p>
<pre><code class="sh"># 导入数据
docker load -i es.tar
</code></pre>
</blockquote>
<h5 id="2-3-1-3-运行"><a href="#2-3-1-3-运行" class="headerlink" title="2.3.1.3.运行"></a>2.3.1.3.运行</h5><blockquote>
<p>运行docker命令，部署单点es：</p>
<pre><code class="sh">docker run -d \
    --name es \
    -e "ES_JAVA_OPTS=-Xms512m -Xmx512m" \
    -e "discovery.type=single-node" \
    -v es-data:/usr/share/elasticsearch/data \
    -v es-plugins:/usr/share/elasticsearch/plugins \
    --privileged \
    --network es-net \
    -p 9200:9200 \
    -p 9300:9300 \
elasticsearch:7.12.1
</code></pre>
<ul>
<li><code>-e "cluster.name=es-docker-cluster"</code>：设置集群名称</li>
<li><code>-e "http.host=0.0.0.0"</code>：监听的地址，可以外网访问</li>
<li><code>-e "ES_JAVA_OPTS=-Xms512m -Xmx512m"</code>：内存大小</li>
<li><code>-e "discovery.type=single-node"</code>：非集群模式</li>
<li><code>-v es-data:/usr/share/elasticsearch/data</code>：挂载逻辑卷，绑定es的数据目录</li>
<li><code>-v es-logs:/usr/share/elasticsearch/logs</code>：挂载逻辑卷，绑定es的日志目录</li>
<li><code>-v es-plugins:/usr/share/elasticsearch/plugins</code>：挂载逻辑卷，绑定es的插件目录</li>
<li><code>--privileged</code>：授予逻辑卷访问权</li>
<li><code>--network es-net</code> ：加入一个名为es-net的网络中</li>
<li><code>-p 9200:9200</code>：端口映射配置</li>
</ul>
<p>浏览器访问：<strong>http://虚拟机ip地址:9200</strong></p>
</blockquote>
<h4 id="2-3-2-部署kibana"><a href="#2-3-2-部署kibana" class="headerlink" title="2.3.2.部署kibana"></a>2.3.2.部署kibana</h4><blockquote>
<p>Kibana 是一个免费且开放的用户界面，能够让您对 Elasticsearch 数据进行可视化，并让您在 Elastic Stack 中进行导航。</p>
</blockquote>
<h5 id="2-3-2-1-部署"><a href="#2-3-2-1-部署" class="headerlink" title="2.3.2.1.部署"></a>2.3.2.1.部署</h5><blockquote>
<p>运行docker命令，部署kibana：</p>
<pre><code class="sh">docker run -d \
--name kibana \
-e ELASTICSEARCH_HOSTS=http://es:9200 \
--network=es-net \
-p 5601:5601  \
kibana:7.12.1
</code></pre>
<ul>
<li><code>--network es-net</code> ：加入一个名为es-net的网络中，与elasticsearch在同一个网络中</li>
<li><code>-e ELASTICSEARCH_HOSTS=http://es:9200"</code>：设置elasticsearch的地址，因为kibana已经与elasticsearch在一个网络，因此可以用容器名直接访问elasticsearch</li>
<li><code>-p 5601:5601</code>：端口映射配置</li>
</ul>
<p>浏览器访问：<strong>http://虚拟机ip地址:5601</strong></p>
</blockquote>
<h4 id="2-3-3-安装IK分词器"><a href="#2-3-3-安装IK分词器" class="headerlink" title="2.3.3.安装IK分词器"></a>2.3.3.安装IK分词器</h4><h5 id="2-3-3-1-在线安装ik插件"><a href="#2-3-3-1-在线安装ik插件" class="headerlink" title="2.3.3.1.在线安装ik插件"></a>2.3.3.1.在线安装ik插件</h5><blockquote>
<pre><code class="sh"># 进入容器内部
docker exec -it elasticsearch /bin/bash
# 在线下载并安装
./bin/elasticsearch-plugin  install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.12.1/elasticsearch-analysis-ik-7.12.1.zip
#退出
exit
#重启容器
docker restart elasticsearch
</code></pre>
</blockquote>
<h5 id="2-3-3-2-离线安装ik插件"><a href="#2-3-3-2-离线安装ik插件" class="headerlink" title="2.3.3.2.离线安装ik插件"></a>2.3.3.2.离线安装ik插件</h5><h6 id="2-3-3-2-1-查看数据卷目录"><a href="#2-3-3-2-1-查看数据卷目录" class="headerlink" title="2.3.3.2.1.查看数据卷目录"></a>2.3.3.2.1.查看数据卷目录</h6><blockquote>
<p>安装插件需要知道elasticsearch的plugins目录位置，而我们用了数据卷挂载，因此需要查看elasticsearch的数据卷目录，通过下面命令查看:</p>
<pre><code class="sh">docker volume inspect es-plugins
</code></pre>
</blockquote>
<h6 id="2-3-3-2-2-解压缩分词器安装包"><a href="#2-3-3-2-2-解压缩分词器安装包" class="headerlink" title="2.3.3.2.2.解压缩分词器安装包"></a>2.3.3.2.2.解压缩分词器安装包</h6><h6 id="2-3-3-2-3-上传到es容器的插件数据卷中"><a href="#2-3-3-2-3-上传到es容器的插件数据卷中" class="headerlink" title="2.3.3.2.3.上传到es容器的插件数据卷中"></a>2.3.3.2.3.上传到es容器的插件数据卷中</h6><blockquote>
<p><code>/var/lib/docker/volumes/es-plugins/_data </code></p>
</blockquote>
<h6 id="2-3-3-2-4-重启容器"><a href="#2-3-3-2-4-重启容器" class="headerlink" title="2.3.3.2.4.重启容器"></a>2.3.3.2.4.重启容器</h6><blockquote>
<pre><code class="sh"># 4、重启容器
docker restart es
</code></pre>
<pre><code class="sh"># 查看es日志
docker logs -f es
</code></pre>
</blockquote>
<h6 id="2-3-3-2-5-测试"><a href="#2-3-3-2-5-测试" class="headerlink" title="2.3.3.2.5.测试"></a>2.3.3.2.5.测试</h6><blockquote>
<p>IK分词器包含两种模式：</p>
<ul>
<li><code>ik_smart</code>：最少切分</li>
<li><code>ik_max_word</code>：最细切分</li>
</ul>
<pre><code class="json">GET /_analyze
{
  "text": "到达世界最高城理塘,太美丽了理塘。看看远处的雪山吧家人们。哎呀，这不是丁真吗？",
  "analyzer": "ik_max_word"
}
</code></pre>
</blockquote>
<h5 id="2-3-3-3-扩展词词典"><a href="#2-3-3-3-扩展词词典" class="headerlink" title="2.3.3.3.扩展词词典"></a>2.3.3.3.扩展词词典</h5><blockquote>
<p>随着互联网的发展，出现了很多新的词语，在原有的词汇列表并不存在。</p>
<p>因此我们的词汇也需要不断的更新，IK分词器提供了扩展词汇的功能。</p>
<ol>
<li><p>打开IK分词器config目录</p>
<p><code>/var/lib/docker/volumes/es-plugins/_data/ik/config/IKAnalyzer.cfg.xml</code></p>
</li>
<li><p>更改IKAnalyzer.cfg.xml配置文件的内容</p>
<pre><code class="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd"&gt;
&lt;properties&gt;
    &lt;comment&gt;IK Analyzer 扩展配置&lt;/comment&gt;
    &lt;!--用户可以在这里配置自己的扩展字典 --&gt;
    &lt;entry key="ext_dict"&gt;ext.dic&lt;/entry&gt;
&lt;/properties&gt;
</code></pre>
</li>
<li><p>创建ext.dic文件，并添加词汇</p>
</li>
<li><p>重启elasticsearch</p>
<pre><code class="sh">docker restart es

# 查看 日志
docker logs -f elasticsearch
</code></pre>
</li>
<li><p>测试</p>
</li>
</ol>
</blockquote>
<h5 id="2-3-3-4-停用词词典"><a href="#2-3-3-4-停用词词典" class="headerlink" title="2.3.3.4.停用词词典"></a>2.3.3.4.停用词词典</h5><blockquote>
<p>在互联网项目中，很多语言是不允许在网络上传递的，如：关于宗教、政治等敏感词语，那么我们在搜索时也应该忽略当前词汇。</p>
<ol>
<li><p>更改IKAnalyzer.cfg.xml配置文件的内容</p>
<pre><code class="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd"&gt;
&lt;properties&gt;
    &lt;comment&gt;IK Analyzer 扩展配置&lt;/comment&gt;
    &lt;!--用户可以在这里配置自己的扩展字典 --&gt;
    &lt;entry key="ext_dict"&gt;ext.dic&lt;/entry&gt;
     &lt;!--用户可以在这里配置自己的扩展停止词字典--&gt;
    &lt;entry key="ext_stopwords"&gt;stopword.dic&lt;/entry&gt;
    &lt;!--用户可以在这里配置远程扩展字典 --&gt;
    &lt;!-- &lt;entry key="remote_ext_dict"&gt;words_location&lt;/entry&gt; --&gt;
    &lt;!--用户可以在这里配置远程扩展停止词字典--&gt;
    &lt;!-- &lt;entry key="remote_ext_stopwords"&gt;words_location&lt;/entry&gt; --&gt;
&lt;/properties&gt;
</code></pre>
</li>
<li><p>在stopword.dic添加停用词</p>
</li>
<li><p>重启elasticsearch</p>
</li>
<li><p>测试</p>
</li>
</ol>
</blockquote>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ol>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_43403025/article/details/114779166">(33条消息) 信息检索——简单易懂的倒排索引（原理+例子）_土豆同学的博客-CSDN博客_倒排索引</a></li>
<li><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95/11001569#2_2">倒排索引_百度百科 (baidu.com)</a></li>
<li><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/elasticsearch/3411206">elasticsearch_百度百科 (baidu.com)</a></li>
</ol>
</article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><em></em><a class="button is-default" href="/2022/08/13/KMP%E7%AE%97%E6%B3%95/" title="KMP算法"><span class="has-text-weight-semibold">下一页: KMP算法</span><i class="iconfont icon-next ml-2 has-text-grey"></i></a></section></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><!--if (debugSNS || theme.social.twitter)--><!--    a(title="twitter" target="_blank" rel="noopener nofollow" href=`//twitter.com/${theme.social.twitter}`)--><!--        i.iconfont.icon-twitter--><!-- Github--><a title="github" target="_blank" rel="noopener nofollow" href="//github.com/mmjzxz"><i class="iconfont icon-github"></i></a><!--// Ins--><!--if (debugSNS || theme.social.instagram)--><!--    a(title="instagram" target="_blank" rel="noopener nofollow" href=`//www.instagram.com/${theme.social.instagram}`)--><!--        i.iconfont.icon-ins--><!--// RSS--><!--if (debugSNS || config.feed && config.feed.enable)--><!--    a(title="rss" target="_blank" rel="noopener nofollow" href= url_for(config.feed.path))--><!--        i.iconfont.icon-rss--><!--// 知乎--><!--if (debugSNS || theme.social.zhihu)--><!--    a(title="zhihu" target="_blank" rel="noopener nofollow" href=`//zhihu.com/${theme.social.zhihu}`)--><!--        i.iconfont.icon-zhihu--><!--// 领英--><!--if (debugSNS || theme.social.linkedin)--><!--    a(title="linkedin" target="_blank" rel="noopener nofollow" href=`//www.linkedin.com/in/${theme.social.linkedin}`)--><!--        i.iconfont.icon-linkedin--><!--// 脸书--><!--if (debugSNS || theme.social.facebook)--><!--    a(title="facebook" target="_blank" rel="noopener nofollow" href=`//www.facebook.com/${theme.social.facebook}`)--><!--        i.iconfont.icon-tian7_facebook--><!-- qq--><!--if (debugSNS || theme.social.qq)--><!--    a(title="qq" target="_blank" rel="noopener nofollow" href=`tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=${theme.social.qq}&website=www.oicqzone.com`)--><!--        i.iconfont.icon-twitter--><!--// email--><!--if (debugSNS || theme.social.email)--><!--    a(title="email" target="_blank" rel="noopener nofollow" href=``)--><!--        i.iconfont.icon-ins--></section><p><span>Copyright ©</span><span> mmjzxz 2022</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"><p>Powered by Hexo &verbar;&nbsp;</p><p class="is-flex is-justify-content-center"><a title="Hexo theme author" target="_blank" rel="noopener" href="//github.com/haojen">Theme by Haojen&nbsp;</a></p><div style="margin-top: 2px"><a class="github-button" title="github-button" target="_blank" rel="noopener" href="https://github.com/haojen/hexo-theme-Claudia" data-color-scheme="no-preference: light; light: light; dark: dark;" data-show-count="true"></a></div></div><div><span></span></div></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/js/post.js"></script></body></html>